# OBJ to Tetrahedron Mesh Toolchain

A toolchain for automating the conversion of OBJ models to tetrahedron meshes (TET format), integrating the full workflow of **OBJ ‚Üí watertight PLY ‚Üí tetrahedral mesh ‚Üí TET format**.  
The pipeline now includes a **mesh repair** step based on **VCGLib** to ensure the input mesh is watertight and manifold before tetrahedralization.

I developed this toolchain for a physics simulation project of mine. The original tetrahedron files for another project were created using a program called PhysX Viewer from NVIDIA PhysX 2.8.4, rather than TetGen. However, the installation package for PhysX 2.8.4 is almost non-existent, and even if you manage to find the installer, there's no guarantee it will run due to its numerous DirectX9 dependencies. What's more challenging is that although the new version of PhysX SDK integrates tetrahedron mesh generation functionality, if you need to generate such tetrahedron files for your geometric model, you would have to delve into the vast codebase of NVIDIA PhysX to write a program to generate Tet files, which is extremely troublesome. Therefore, I came up with the idea of merging and converting files generated by TetGen, allowing these Tet files to continue to be generated and used.

---

## üì¶ Tool Components

| Tool Name | Function | Core Dependencies |
|-----------|----------|-------------------|
| `mesh_repair.exe` | **Repair OBJ models** to guarantee watertightness: remove duplicate vertices/faces, delete unreferenced vertices, remove degenerate faces, fix self-intersections, fill holes, and orient faces consistently. | [VCGLib](http://vcg.isti.cnr.it/vcglib/) (GPL) |
| `obj2ply.exe` | Convert OBJ models to tetgen‚Äëcompatible ASCII‚Äëformat PLY files | trimesh (Python) |
| `tetgen.exe` | Mesh PLY files into tetrahedral grids and generate `.node`/`.ele` files | [tetgen 1.5.1](https://wias-berlin.de/software/tetgen/) (AGPL v3) |
| `nodele2tet.exe` | Merge tetgen‚Äëgenerated `.node`/`.ele` files into custom TET format files | Self‚Äëdeveloped C++ |
| `obj2tet.exe` | Execute the full "OBJ ‚Üí TET" workflow in one click | All tools above |

---

## üöÄ Quick Start

### 1. Repair a Mesh (Optional but Recommended)
Before tetrahedralization, ensure your OBJ is watertight and manifold:
```bash
mesh_repair input.obj output.ply
```
This produces a repaired PLY file that can be fed directly into `tetgen`.  
*Note:* The repaired PLY contains only vertices and faces (no normals or colors) ‚Äì exactly what tetgen requires.

### 2. One‚ÄëClick Full Workflow (Recommended)
Automate all steps with `obj2tet.exe`:
```bash
# Basic usage: default max tetrahedron volume 0.001, no intermediate files retained
obj2tet example.obj

# Custom parameters: max volume 0.0005, retain intermediate files (PLY/NODE/ELE)
obj2tet example.obj 0.0005 1
```
**Parameters:**
- `input.obj` ‚Äì Path to the input OBJ model.
- `0.001` (optional) ‚Äì Maximum tetrahedron volume (smaller ‚Üí denser mesh).
- `1` (optional) ‚Äì Retain intermediate files (1 = keep, default = delete).

The tool automatically calls `mesh_repair` (if needed), `tetgen`, and `nodele2tet` in sequence.

### 3. Step‚Äëby‚ÄëStep Manual Conversion (Debugging/Customization)
If you prefer to run each tool separately:

#### ‚ë† Repair OBJ ‚Üí watertight PLY
```bash
mesh_repair input.obj repaired.ply
```

#### ‚ë° Convert repaired PLY to NODE/ELE
```bash
tetgen -pqO -a0.001 repaired.ply
```
- `-pqO`: High‚Äëquality, optimized tetrahedral mesh.
- `-a0.001`: Limit each tetrahedron‚Äôs volume to ‚â§0.001.
- Output: `repaired.1.node`, `repaired.1.ele`

#### ‚ë¢ Convert NODE/ELE to TET
```bash
# 0‚Äëbased indices (convert tetgen‚Äôs 1‚Äëbased indices to 0‚Äëbased)
nodele2tet -0 repaired.1.node repaired.1.ele output.tet

# 1‚Äëbased indices (keep tetgen‚Äôs original indexing)
nodele2tet -1 repaired.1.node repaired.1.ele output.tet
```

---

## üìú License

This project consists of three parts with different licenses. Please read carefully before use.

### 1. Self‚ÄëDeveloped Tools (MIT License)
The following tools are original work and are licensed under the **MIT License**:
- `obj2ply.py` / `obj2ply.exe`
- `nodele2tet.cpp` / `nodele2tet.exe`
- `obj2tet.cpp` / `obj2tet.exe`

**MIT License**  
Copyright (c) 2026 Ruiyi Du  
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the conditions that the above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED.

### 2. Mesh Repair Tool (GNU GPL v3)
`mesh_repair.exe` is built upon **VCGLib** (Visual and Computer Graphics Library), which is licensed under the **GNU General Public License version 3**. Consequently, the `mesh_repair` tool as a whole is also distributed under **GPL v3**.  
- Source code of `mesh_repair` (based on VCGLib) is available in the `mesh_repair/` folder.
- VCGLib homepage: [http://vcglib.net/](http://vcglib.net/)
- Full GPL v3 license text can be found in `mesh_repair/COPYING`.

**Important:** If you modify `mesh_repair` or use its source in your own project, you must comply with the GPL v3 (i.e., any derivative work must also be open‚Äësourced under GPL).

### 3. Third‚ÄëParty Component: tetgen (GNU AGPL v3)
The toolchain includes **tetgen 1.5.1** (original author Hang Si, [https://wias-berlin.de/software/tetgen/](https://wias-berlin.de/software/tetgen/)), licensed under the **GNU Affero General Public License v3**.  
- The complete source code of tetgen 1.5.1 is provided in the `tetgen1.5.1/` folder.
- The binary `tetgen.exe` is compiled from that source.
- If you modify the tetgen source, you **must** make your modifications available under AGPL v3.
- The full license text is in `tetgen1.5.1/AGPL-3.0.txt`.

**Compliance Notes:**
- When distributing this toolchain, you must retain all license notices.
- The `tetgen1.5.1/` folder containing the tetgen source must accompany the binary `tetgen.exe`.
- For commercial use of tetgen, please review the AGPL v3 requirements (especially concerning network services).

---

## üõ†Ô∏è Deployment Instructions

1. Place all executables (`mesh_repair.exe`, `obj2ply.exe`, `tetgen.exe`, `nodele2tet.exe`, `obj2tet.exe`) in the **same directory**, or add that directory to your system `PATH`.
2. The folders `tetgen1.5.1/` and `mesh_repair/` (containing source code and license files) **must** be kept together with the binaries to satisfy open‚Äësource license obligations.
3. To rebuild any tool, use the provided source files and respective build systems (CMake for C++ tools, PyInstaller for Python tools).

---

## üéØ Frequently Asked Questions

### Q: Why do I need `mesh_repair`? My OBJ looks fine.
A: Tetgen requires a **watertight, manifold** surface mesh. Many OBJ files contain duplicate vertices, unused vertices, degenerate faces, small holes, or inconsistent face orientations. `mesh_repair` fixes all these issues automatically, significantly increasing the success rate of tetrahedralization.

### Q: What exactly does `mesh_repair` do?
A: It performs the following operations in sequence (based on VCGLib):
- Remove duplicate vertices (within a small tolerance)
- Remove vertices not referenced by any face
- Remove duplicate faces
- Remove degenerate faces (area zero)
- Detect and remove self‚Äëintersecting faces
- Detect and fill holes (up to a configurable size)
- Orient all faces consistently (outward or inward)
- Update normals (optional)

### Q: Why is `mesh_repair.exe` so large?
A: It is statically linked with VCGLib and compiled in release mode. VCGLib is a header‚Äëonly library, but the compiled code includes all necessary algorithms; the size is normal for a mesh processing tool.

### Q: Can I use `mesh_repair` in my own commercial project?
A: Because `mesh_repair` is based on VCGLib (GPL v3), any project that links to or distributes `mesh_repair` must also be open‚Äësourced under GPL v3. If this is not acceptable, you may consider using a different mesh repair library with a more permissive license (e.g., CGAL with a commercial license) and replace the tool.

### Q: How do I contribute to the toolchain?
A: Feel free to submit issues or pull requests on the project repository. Please respect the license of each component when making changes.

---

## üìû Feedback and Contributions

If you encounter problems or have suggestions, please open an issue or pull request in the project repository.

*This toolchain is intended for academic/open-source projects only. For commercial use, please independently evaluate compliance with the tetgen AGPL v3 license.*

